# 图表响应式指令使用指南


## 指令列表

### 1. `v-chart-resize` - 基础响应式指令

简单易用的图表响应式指令，自动监听容器尺寸变化并调整图表大小。

#### 使用方式

```vue
<template>
  <!-- 方式一：传入 ECharts 实例 -->
  <div v-chart-resize="chartInstance" ref="chartContainer"></div>
  
  <!-- 方式二：自动检测（需要将 ECharts 实例存储在元素上） -->
  <div v-chart-resize ref="chartContainer"></div>
</template>

<script>
import echarts from 'echarts'

export default {
  data() {
    return {
      chartInstance: null
    }
  },
  mounted() {
    this.initChart()
  },
  methods: {
    initChart() {
      this.chartInstance = echarts.init(this.$refs.chartContainer)
      // 配置图表...
      this.chartInstance.setOption({
        // 图表配置
      })
    }
  }
}
</script>
```

### 2. `v-chart-responsive` - 增强版响应式指令

提供更多配置选项和高级功能的图表响应式指令。

#### 使用方式

```vue
<template>
  <!-- 基础用法 -->
  <div v-chart-responsive="{ chart: chartInstance }" ref="chartContainer"></div>
  
  <!-- 完整配置 -->
  <div 
    v-chart-responsive="{
      chart: chartInstance,
      delay: 300,
      minWidth: 300,
      minHeight: 200,
      maintainAspectRatio: true,
      aspectRatio: 16/9,
      onResize: handleChartResize
    }" 
    ref="chartContainer">
  </div>
</template>

<script>
import echarts from 'echarts'

export default {
  data() {
    return {
      chartInstance: null
    }
  },
  mounted() {
    this.initChart()
  },
  methods: {
    initChart() {
      this.chartInstance = echarts.init(this.$refs.chartContainer)
      this.chartInstance.setOption({
        // 图表配置
      })
    },
    handleChartResize(size) {
      console.log('图表尺寸变化:', size)
      // 自定义处理逻辑
    }
  }
}
</script>
```

## 配置选项

### `v-chart-responsive` 配置参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `chart` | ECharts Instance | - | ECharts 图表实例 |
| `delay` | Number | 300 | 防抖/节流延迟时间（毫秒） |
| `throttle` | Boolean | false | 是否使用节流而非防抖 |
| `minWidth` | Number | 100 | 最小宽度（像素） |
| `minHeight` | Number | 100 | 最小高度（像素） |
| `maintainAspectRatio` | Boolean | false | 是否保持宽高比 |
| `aspectRatio` | Number | 16/9 | 宽高比 |
| `animationDuration` | Number | 300 | 动画持续时间（毫秒） |
| `watchParent` | Boolean | true | 是否监听父容器变化 |
| `autoInit` | Boolean | true | 是否自动初始化 |
| `onResize` | Function | - | 自定义 resize 回调函数 |

## 注册指令

### 全局注册

```javascript
// main.js 或入口文件
import Vue from 'vue'
import directives from '@/directives'

// 注册所有指令
Vue.use(directives)

// 或者按需注册
import { chartResize, chartResponsive } from '@/directives'
Vue.directive('chart-resize', chartResize)
Vue.directive('chart-responsive', chartResponsive)
```

### 局部注册

```vue
<script>
import { chartResize, chartResponsive } from '@/directives'

export default {
  directives: {
    'chart-resize': chartResize,
    'chart-responsive': chartResponsive
  }
}
</script>
```

## 使用场景

### 1. 仪表板图表

```vue
<template>
  <div class="dashboard">
    <div class="chart-container">
      <div v-chart-responsive="chartOptions" ref="chart1"></div>
    </div>
  </div>
</template>

<script>
export default {
  computed: {
    chartOptions() {
      return {
        chart: this.chartInstance,
        minWidth: 300,
        minHeight: 200,
        maintainAspectRatio: true,
        aspectRatio: 2,
        onResize: this.updateLayout
      }
    }
  }
}
</script>
```

### 2. 响应式网格布局

```vue
<template>
  <div class="grid-layout">
    <div 
      v-for="(chart, index) in charts" 
      :key="index"
      v-chart-resize="chart.instance"
      class="grid-item">
    </div>
  </div>
</template>

<style>
.grid-layout {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.grid-item {
  height: 300px;
}
</style>
```

### 3. 弹窗中的图表

```vue
<template>
  <el-dialog 
    :visible.sync="dialogVisible" 
    @opened="handleDialogOpened"
    width="800px">
    <div 
      v-chart-responsive="{
        chart: modalChartInstance,
        delay: 100,
        autoInit: false
      }" 
      ref="modalChart"
      style="height: 400px;">
    </div>
  </el-dialog>
</template>

<script>
export default {
  methods: {
    handleDialogOpened() {
      this.$nextTick(() => {
        // 手动触发初始化
        this.initModalChart()
      })
    }
  }
}
</script>
```

## 注意事项

1. **内存管理**：指令会自动清理所有监听器，无需手动处理
2. **性能优化**：使用防抖/节流机制，避免频繁的 resize 操作
3. **兼容性**：优先使用 ResizeObserver，不支持时自动降级到传统方式
4. **错误处理**：内置错误捕获机制，确保图表调整失败不影响页面功能

## 最佳实践

1. **合理设置防抖延迟**：一般情况下 300ms 即可，频繁变化的场景可适当减少
2. **使用最小尺寸限制**：防止图表过小影响可读性
3. **自定义回调函数**：利用 `onResize` 回调处理复杂的布局逻辑
4. **按需选择指令**：简单场景使用 `v-chart-resize`，复杂需求使用 `v-chart-responsive`