# OnlineJudge 题目上传指南

本文档介绍如何在 OnlineJudge 系统中上传题目，包括通过Web界面创建题目和批量导入题目的方法。

## 目录
- [方法一：通过Web管理界面创建题目（推荐）](#方法一通过web管理界面创建题目推荐)
- [方法二：FPS格式批量导入](#方法二fps格式批量导入)
- [方法三：通过API创建题目](#方法三通过api创建题目)
- [测试用例格式说明](#测试用例格式说明)
- [常见问题](#常见问题)

---

## 方法一：通过Web管理界面创建题目（推荐）

### 前置要求
- 已部署并运行 OnlineJudge 系统
- 拥有管理员权限（默认账号：`root`，密码：`rootroot`）

### 步骤

#### 1. 登录管理后台
访问：`http://YOUR_SERVER_IP/admin` 或 `http://localhost/admin`

使用管理员账号登录。

#### 2. 进入题目管理页面
在管理后台导航栏中找到 **"Problem"** 或 **"题目"** 菜单，点击进入题目列表页面。

#### 3. 创建新题目
点击 **"Create Problem"** 或 **"创建题目"** 按钮，进入题目编辑页面。

#### 4. 填写题目基本信息

**必填项：**
- **Display ID**：题目的显示ID（唯一标识，如：`1000`、`A+B`）
- **Title**：题目标题
- **Description**：题目描述（支持 Markdown 和 MathJax）
- **Input Description**：输入描述
- **Output Description**：输出描述
- **Samples**：样例输入输出（至少一个）
- **Time Limit**：时间限制（毫秒，1-60000）
- **Memory Limit**：内存限制（MB，1-1024）
- **Languages**：支持的语言（C、C++、Java、Python2、Python3）
- **Rule Type**：规则类型（ACM 或 OI）
- **Difficulty**：难度等级
- **Tags**：题目标签（至少一个，详见下方"题目标签设置"部分）

**可选项：**
- **Hint**：提示信息
- **Source**：题目来源
- **Template**：代码模板（可选）
- **Visible**：是否公开可见
- **Share Submission**：是否允许分享提交

#### 5. 配置输入输出模式（I/O Mode）

**Standard IO**（标准输入输出）：
- 程序从标准输入读取，输出到标准输出
- 适用于大多数题目

**File IO**（文件输入输出）：
- 程序从指定文件读取输入，输出到指定文件
- 需要设置：
  - **Input File Name**：输入文件名（如：`input.txt`）
  - **Output File Name**：输出文件名（如：`output.txt`）

#### 6. 配置特殊判题（SPJ，可选）

如果题目需要特殊判题（Special Judge）：
1. 勾选 **"SPJ"** 选项
2. 选择 **SPJ Language**（C 或 C++）
3. 编写 SPJ 代码
4. 点击 **"Compile"** 编译 SPJ 代码
5. 确保编译成功后再上传测试用例

#### 7. 准备测试用例

根据题目类型准备测试用例：

**普通题目（非SPJ）：**
- 需要成对的输入输出文件
- 文件命名格式：`1.in`, `1.out`, `2.in`, `2.out`, `3.in`, `3.out` ...
- 将所有文件打包成 ZIP 格式

**SPJ题目：**
- 只需要输入文件
- 文件命名格式：`1.in`, `2.in`, `3.in` ...
- 将所有文件打包成 ZIP 格式

**示例目录结构：**
```
test_cases/
├── 1.in
├── 1.out
├── 2.in
├── 2.out
├── 3.in
└── 3.out
```

打包后：`test_cases.zip`

#### 8. 上传测试用例

1. 在题目编辑页面找到 **"TestCase"** 或 **"测试用例"** 区域
2. 点击 **"Choose File"** 按钮
3. 选择准备好的 ZIP 文件
4. 等待上传完成
5. 系统会自动解析测试用例并显示文件列表

**注意：**
- 如果切换了 SPJ 模式，需要重新上传测试用例
- 测试用例上传成功后，会显示每个测试用例的文件名和大小
- 对于 OI 模式的题目，可以设置每个测试用例的分数

#### 9. 设置题目标签

题目标签用于分类和搜索题目，每个题目至少需要一个标签。

**添加标签的方法：**

1. **找到标签输入区域**：
   - 在题目编辑页面，向下滚动找到表单区域
   - 在 **"Visible"**（可见性）和 **"Share Submission"**（分享提交）开关的下方
   - 找到 **"Tag"** 或 **"标签"** 字段（通常在表单的中间偏下位置）
   - 如果还没有添加任何标签，会显示一个小的按钮：**"+ New Tag"**（英文界面）或 **"+ 新增标签"**（中文界面）
   - 如果已经有标签，标签会以绿色标签块形式显示，按钮在标签右侧
   - **提示**：如果找不到，可以按 `Ctrl+F` 搜索页面中的 "Tag" 或 "标签" 文字

2. **添加标签**：
   - 点击 **"+ New Tag"** 或 **"+ 新增标签"** 按钮
   - 会弹出一个输入框（自动完成输入框）
   - 在输入框中输入标签名称（支持中文和英文）
   - 系统会自动搜索并显示匹配的已有标签（输入时会显示下拉建议列表）
   - 从下拉列表中选择标签，或直接输入新标签名称后按回车键添加
   - 如果标签不存在，系统会自动创建

3. **删除标签**：
   - 点击已添加标签右侧的 **×** 按钮即可删除
   - 注意：至少需要保留一个标签

**界面说明：**
- 标签显示为绿色的标签块
- 输入框支持自动完成功能，输入时会显示匹配的已有标签
- 可以添加多个标签（建议2-5个）

**常用标签推荐：**

- **算法类型**：`greedy`（贪心）、`dp`（动态规划）、`graph`（图论）、`math`（数学）、`geometry`（几何）、`string`（字符串）、`tree`（树）、`binary-search`（二分查找）
- **难度等级**：`easy`（简单）、`medium`（中等）、`hard`（困难）、`beginner`（入门）
- **题目来源**：`leetcode`、`codeforces`、`atcoder`、`luogu`（洛谷）
- **其他**：`implementation`（实现）、`simulation`（模拟）、`constructive`（构造）

**标签命名建议：**
- 使用小写字母和连字符（如：`dynamic-programming`）
- 保持标签名称简洁明了
- 统一使用英文或中文，避免混用
- 建议使用系统已有的标签，便于题目分类管理

#### 10. 保存题目

检查所有信息无误后，点击 **"Save"** 或 **"保存"** 按钮保存题目。

---

## 方法二：FPS格式批量导入

FPS（Free Problem Set）是一种标准的题目格式，支持批量导入多个题目。

### 步骤

#### 1. 准备FPS格式文件

FPS 格式是一个 XML 文件，包含一个或多个题目的信息。文件格式示例：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<fps version="1.2">
  <item>
    <title>A+B Problem</title>
    <description>Calculate A + B</description>
    <input>Two integers A and B</input>
    <output>Output A + B</output>
    <time_limit unit="ms">1000</time_limit>
    <memory_limit unit="mb">256</memory_limit>
    <test_input>1 2</test_input>
    <test_output>3</test_output>
    <!-- 更多测试用例 -->
  </item>
  <!-- 更多题目 -->
</fps>
```

#### 2. 导入题目

1. 登录管理后台
2. 进入题目管理页面
3. 找到 **"Import Problem"** 或 **"导入题目"** 功能
4. 选择 FPS 格式的 XML 文件
5. 点击上传
6. 系统会自动解析并创建所有题目

**注意：**
- FPS 文件必须符合版本 1.1 或 1.2 规范
- 导入的题目会自动创建测试用例目录
- 如果题目ID冲突，导入可能会失败

---

## 方法三：通过API创建题目

适用于需要程序化创建题目的场景。

### API 端点

**创建题目：** `POST /api/admin/problem`

**上传测试用例：** `POST /api/admin/test_case`

### 请求示例

#### 1. 先上传测试用例

```bash
curl -X POST http://YOUR_SERVER_IP/api/admin/test_case \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@test_cases.zip" \
  -F "spj=false"
```

响应示例：
```json
{
  "error": null,
  "data": {
    "id": "abc123def456",
    "info": [
      {
        "input_name": "1.in",
        "output_name": "1.out",
        "input_size": 10,
        "output_size": 5
      }
    ],
    "spj": false
  }
}
```

#### 2. 创建题目

```bash
curl -X POST http://YOUR_SERVER_IP/api/admin/problem \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "_id": "1000",
    "title": "A+B Problem",
    "description": "Calculate A + B",
    "input_description": "Two integers A and B",
    "output_description": "Output A + B",
    "samples": [{"input": "1 2", "output": "3"}],
    "test_case_id": "abc123def456",
    "test_case_score": [{"input_name": "1.in", "output_name": "1.out", "score": 0}],
    "time_limit": 1000,
    "memory_limit": 256,
    "languages": ["C", "C++", "Java", "Python2", "Python3"],
    "template": {},
    "rule_type": "ACM",
    "io_mode": {"io_mode": "standard", "input": "", "output": ""},
    "spj": false,
    "spj_language": null,
    "spj_code": null,
    "visible": true,
    "difficulty": "Low",
    "tags": ["math", "beginner"],  // 标签列表，如果标签不存在会自动创建
    "hint": "",
    "source": "",
    "share_submission": false
  }'
```

---

## 测试用例格式说明

### 普通题目（非SPJ）

**文件命名规则：**
- 必须成对出现：`1.in` 和 `1.out`，`2.in` 和 `2.out`，以此类推
- 编号必须从 1 开始，连续递增
- 不能跳过编号（如：不能只有 `1.in`, `1.out`, `3.in`, `3.out`）

**ZIP文件结构：**
```
test_cases.zip
├── 1.in
├── 1.out
├── 2.in
├── 2.out
├── 3.in
└── 3.out
```

### SPJ题目（特殊判题）

**文件命名规则：**
- 只需要输入文件：`1.in`, `2.in`, `3.in` ...
- 编号必须从 1 开始，连续递增

**ZIP文件结构：**
```
test_cases.zip
├── 1.in
├── 2.in
└── 3.in
```

### 文件内容格式

- 文件编码：UTF-8
- 换行符：Unix 格式（LF），系统会自动转换 Windows 格式（CRLF）
- 输出文件末尾的空白行会被自动去除（用于MD5校验）

### 创建测试用例示例

**Linux/Mac：**
```bash
# 创建测试用例目录
mkdir test_cases
cd test_cases

# 创建输入输出文件
echo "1 2" > 1.in
echo "3" > 1.out
echo "10 20" > 2.in
echo "30" > 2.out

# 打包成ZIP
zip -r test_cases.zip *.in *.out
```

**Windows：**
```powershell
# 创建测试用例目录
mkdir test_cases
cd test_cases

# 创建输入输出文件
"1 2" | Out-File -Encoding utf8 1.in
"3" | Out-File -Encoding utf8 1.out
"10 20" | Out-File -Encoding utf8 2.in
"30" | Out-File -Encoding utf8 2.out

# 打包成ZIP（使用压缩工具或PowerShell）
Compress-Archive -Path *.in,*.out -DestinationPath test_cases.zip
```

---

## 常见问题

### 1. 测试用例上传失败：Empty file

**原因：** ZIP文件中没有符合命名规则的测试用例文件

**解决方案：**
- 检查文件命名是否正确（`1.in`, `1.out` 等）
- 确保文件在ZIP的根目录，不在子目录中
- 对于SPJ题目，确保只有 `.in` 文件
- 对于普通题目，确保 `.in` 和 `.out` 文件成对出现

### 2. 测试用例上传失败：Bad zip file

**原因：** ZIP文件损坏或格式不正确

**解决方案：**
- 重新打包ZIP文件
- 使用标准的ZIP压缩工具
- 检查ZIP文件是否完整

### 3. 题目创建失败：Display ID already exists

**原因：** 题目的Display ID已存在

**解决方案：**
- 修改Display ID为唯一值
- 或先删除已存在的题目

### 4. SPJ编译失败

**原因：** SPJ代码有语法错误或逻辑错误

**解决方案：**
- 检查SPJ代码语法
- 确保SPJ代码符合要求（接收输入文件路径和输出文件路径作为参数）
- 查看编译错误信息进行修复

### 5. 测试用例编号不连续

**原因：** 测试用例文件编号跳过了某些数字

**解决方案：**
- 重新命名文件，确保从1开始连续编号
- 例如：如果有 `1.in`, `1.out`, `3.in`, `3.out`，需要将 `3.in` 和 `3.out` 重命名为 `2.in` 和 `2.out`

### 6. OI模式题目分数设置

**说明：** OI模式的题目需要为每个测试用例设置分数

**操作：**
- 测试用例上传后，在测试用例列表中为每个测试用例设置分数
- 所有测试用例的分数总和会自动计算为 `total_score`
- 每个测试用例的分数必须大于0

### 7. 题目标签相关问题

#### 7.1 如何查看所有已有标签？

**方法：**
- 在题目创建/编辑页面的标签输入框中输入关键词，系统会自动显示匹配的标签
- 或者通过API获取：`GET /api/problem/tags?keyword=关键词`

#### 7.5 找不到标签输入按钮怎么办？

**可能的原因和解决方案：**

1. **按钮被隐藏**：
   - 检查页面是否完全加载
   - 尝试刷新页面（F5）
   - 检查浏览器控制台是否有JavaScript错误

2. **界面语言问题**：
   - 中文界面显示的是 **"+ 新增标签"** 而不是 "+ New Tag"
   - 英文界面显示的是 **"+ New Tag"**

3. **标签区域位置**：
   - 标签输入区域在表单的中间位置
   - 在 "Visible"（可见性）开关和 "Languages"（语言）选择框之间
   - 如果页面很长，需要向下滚动查找

4. **如果仍然找不到**：
   - 检查是否有管理员权限（只有管理员可以创建/编辑题目）
   - 确认访问的是正确的URL：`/admin/problem` 或 `/admin/problem/create`
   - 尝试使用浏览器的开发者工具检查页面元素

#### 7.2 标签可以删除吗？

**说明：**
- 标签一旦创建就会保留在系统中
- 如果某个标签没有被任何题目使用，它不会显示在标签列表中
- 删除题目的标签不会删除标签本身，只是解除关联

#### 7.3 标签名称有长度限制吗？

**说明：**
- 标签名称理论上没有严格长度限制，但建议保持简洁（通常不超过32个字符）
- 标签名称区分大小写（如：`DP` 和 `dp` 是不同的标签）

#### 7.4 如何批量管理标签？

**方法：**
- 目前系统不支持批量管理标签的Web界面
- 可以通过API或数据库操作批量管理
- 建议统一标签命名规范，避免创建重复标签

---

## 最佳实践

1. **测试用例准备**
   - 准备足够多的测试用例，包括边界情况和特殊情况
   - 确保测试用例覆盖各种可能的输入情况
   - 测试用例应该包括简单、中等、困难等不同难度

2. **题目描述**
   - 使用清晰的描述，避免歧义
   - 提供足够的样例说明
   - 使用 Markdown 格式化，提高可读性
   - 对于数学题目，使用 MathJax 公式

3. **时间限制设置**
   - 根据题目难度和算法复杂度合理设置时间限制
   - 考虑不同语言的执行效率差异
   - 建议：简单题目 1000ms，中等题目 2000ms，困难题目 3000-5000ms

4. **内存限制设置**
   - 根据题目需求合理设置内存限制
   - 建议：大多数题目 256MB，需要大数组的题目 512MB-1024MB

5. **代码模板**
   - 为初学者提供代码模板，降低入门门槛
   - 模板应该包含基本的输入输出框架

6. **标签管理**
   - 使用有意义的标签，便于题目分类和搜索
   - 常见标签：`math`, `greedy`, `dp`, `graph`, `string`, `geometry` 等
   - 建议为每个题目添加2-5个标签，涵盖算法类型、难度、来源等维度
   - 优先使用系统已有的标签，保持标签命名一致性
   - 定期检查并合并重复标签（如：`dp` 和 `dynamic-programming`）

---

## 相关资源

- [FPS 格式规范](https://github.com/zhblue/freeproblemset)
- [Django REST Framework 文档](https://www.django-rest-framework.org/)

---

**最后更新：** 2024年

